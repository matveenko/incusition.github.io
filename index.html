<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inquisition Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* === –¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê === */
            --bg-grad: radial-gradient(circle at center, #1a0508 0%, #000000 100%);
            --ivory: #FFFFF0;
            --blood: #ff3333;
            --gold: #FFD700;
            --radius: 16px;
            --header-h: 60px; 
            --sheet-bg: #0f0505;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background: #000;
            color: var(--ivory);
            padding-bottom: 50px;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none; -webkit-user-select: none;
        }

        /* === –§–û–ù === */
        .bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: var(--bg-grad); }
        .bg-noise {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.05; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* === PRELOADER === */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999;
            overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.3s ease, visibility 0.3s;
        }
        #preloader.hide { opacity: 0; visibility: hidden; pointer-events: none; }
        #runeContainer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; perspective: 800px; pointer-events: none; overflow: hidden; z-index: 1; }
        .rune-particle { position: absolute; font-family: 'Courier New', serif; font-weight: 900; opacity: 0; pointer-events: none; will-change: transform, opacity; text-shadow: 0 0 15px var(--blood); }
        @keyframes chaosZoom { 
            0% { transform: translate3d(0, 0, -1500px) rotate3d(1, 1, 1, 0deg); opacity: 0; }
            5% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate3d(var(--driftX), var(--driftY), 800px) rotate3d(var(--rx), var(--ry), var(--rz), 720deg); opacity: 0; }
        }
        .loader-center { position: relative; z-index: 10; text-align: center; width: 100%; }
        .loader-title { font-size: 32px; font-weight: 900; letter-spacing: 12px; color: var(--ivory); margin-bottom: 20px; opacity: 0; transform: scale(0.9); animation: appearSolid 1.5s ease forwards; }
        .loader-logs { font-family: 'Courier New', monospace; font-size: 11px; color: var(--blood); letter-spacing: 2px; height: 20px; font-weight: 700; text-shadow: 0 0 10px rgba(255, 51, 51, 0.6); text-transform: uppercase; }
        @keyframes appearSolid { 0% { opacity: 0; transform: scale(0.9); filter: blur(10px); } 20% { opacity: 1; transform: scale(1); filter: blur(0); } 100% { opacity: 1; transform: scale(1); } }

        /* === UI === */
        .anim-entry { opacity: 0; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; transform: translate3d(0,0,0); will-change: transform, opacity; }
        .visible-static { opacity: 1 !important; animation: none !important; transform: none !important; }
        .hidden-screen { display: none !important; }
        @keyframes slideUp { from { opacity: 0; transform: translate3d(0, 20px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }

        .header-container { position: fixed; top: 0; left: 0; width: 100%; height: var(--header-h); background: rgba(20, 5, 8, 0.98); z-index: 100; padding: 0 15px; border-bottom: 1px solid rgba(255, 255, 240, 0.05); display: flex; flex-direction: column; justify-content: center; }
        .header-top-row { display: flex; align-items: center; gap: 10px; width: 100%; }
        .back-btn { width: 40px; height: 40px; background: rgba(255,255,255,0.05); border-radius: 12px; color: var(--ivory); font-weight: 800; font-size: 18px; cursor: pointer; display: none; align-items: center; justify-content: center; border: 1px solid rgba(255, 255, 240, 0.1); }
        .search-box { flex: 1; height: 40px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255, 255, 240, 0.1); border-radius: 12px; padding: 0 15px; color: var(--ivory); font-size: 15px; }
        
        .highlight { background: rgba(255, 51, 51, 0.4); color: #fff; border-radius: 4px; padding: 0 2px; font-weight: bold; }

        .tags-wrapper { display: none; gap: 8px; overflow-x: auto; position: absolute; bottom: -45px; left: 0; width: 100%; padding: 5px 15px; background: rgba(20, 5, 8, 0.98); scrollbar-width: none; }
        .tag { white-space: nowrap; padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 30px; font-size: 12px; font-weight: 700; color: rgba(255, 255, 240, 0.5); cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .tag.active { background: var(--ivory); color: #1a0505; font-weight: 900; }

        .main-content { padding: calc(var(--header-h) + 20px) 15px 40px 15px; }

        .progress-card { background: rgba(40, 10, 10, 0.6); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255, 255, 240, 0.08); box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        .rank-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; }
        .rank-title { font-size: 12px; color: rgba(255, 255, 240, 0.4); text-transform: uppercase; font-weight: 700; }
        .rank-name { font-size: 20px; font-weight: 900; color: var(--ivory); text-transform: uppercase; margin-top: 4px; text-shadow: 0 0 20px rgba(255, 255, 240, 0.1); }
        .rank-name.gold { color: var(--gold); text-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .progress-bar-bg { width: 100%; height: 6px; background: rgba(0,0,0,0.5); border-radius: 4px; overflow: hidden; margin-bottom: 15px; }
        .progress-bar-fill { height: 100%; background: var(--blood); width: 0%; border-radius: 4px; transition: width 0.8s ease; box-shadow: 0 0 10px var(--blood); }

        .achievements-row { display: flex; gap: 4px; justify-content: space-between; overflow-x: auto; padding: 10px 5px; scrollbar-width: none; }
        .badge { width: 40px; height: 40px; min-width: 40px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 19px; filter: grayscale(1) opacity(0.4); transition: 0.2s; cursor: pointer; }
        .badge.unlocked { filter: grayscale(0) opacity(1); border-color: var(--ivory); background: rgba(255,255,255,0.1); color: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.1); }
        .badge:active { transform: scale(0.9); }

        #homeTilesContainer { display: grid; grid-template-columns: repeat(auto-fit, minmax(145px, 1fr)); gap: 15px; margin-top: 15px; }
        .category-tile { background: rgba(255, 255, 255, 0.03); border-radius: var(--radius); padding: 25px 20px; cursor: pointer; border: 1px solid rgba(255, 255, 240, 0.08); min-height: 140px; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.1s; }
        .category-tile:active { transform: scale(0.97); background: rgba(255,255,255,0.08); border-color: var(--blood); }
        .tile-icon { font-size: 32px; margin-bottom: 15px; }
        .tile-title { font-size: 13px; font-weight: 800; color: var(--ivory); text-transform: uppercase; line-height: 1.2; word-break: break-word; }
        .tile-count { font-size: 12px; color: rgba(255, 255, 240, 0.3); margin-top: 8px; }

        .special-card { margin-bottom: 15px; border-radius: var(--radius); padding: 20px; cursor: pointer; position: relative; overflow: hidden; background: rgba(40, 10, 10, 0.6); border: 1px solid rgba(255, 255, 240, 0.08); display: flex; flex-direction: column; justify-content: center; }
        .special-card:active { transform: scale(0.98); }
        .card-gold { border-left: 5px solid var(--gold); }
        .sp-title { font-weight: 900; font-size: 18px; text-transform: uppercase; margin-bottom: 5px; color: var(--gold); }
        .sp-desc { font-size: 13px; color: var(--text-sec); opacity: 0.8; }
        .sp-bg-icon { position: absolute; right: -10px; bottom: -15px; font-size: 70px; opacity: 0.05; transform: rotate(-20deg); filter: grayscale(1); pointer-events: none; }
        #credoBtn .sp-title { color: var(--ivory) !important; }

        #favBtn {
            background: linear-gradient(135deg, #0a0000 0%, #1a0505 100%);
            border: 1px solid #4a0a0a;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(20, 0, 0, 0.8);
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.3s;
        }
        #favBtn:active { transform: scale(0.98); border-color: #ff3333; }
        #favBtn::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, rgba(255, 51, 51, 0.2) 0%, transparent 60%);
            animation: occultPulse 4s infinite ease-in-out;
            pointer-events: none;
        }
        #favBtn .sp-title { color: #ff3333 !important; text-shadow: 0 0 15px rgba(255, 51, 51, 0.4); display: flex; align-items: center; gap: 10px; position: relative; z-index: 2; }
        #favBtn .sp-desc { color: var(--ivory); opacity: 0.8; font-family: 'Courier New', monospace; text-transform: uppercase; letter-spacing: 1px; position: relative; z-index: 2; }
        #favBtn svg { fill: #ff3333 !important; filter: drop-shadow(0 0 8px rgba(255, 51, 51, 0.6)); }
        @keyframes occultPulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* LIST VIEW */
        .section-header { margin: 25px 0 15px 0; color: var(--blood); font-weight: 800; font-size: 13px; letter-spacing: 1px; text-transform: uppercase; border-left: 3px solid var(--blood); padding-left: 10px; }
        .posts-list { display: flex; flex-direction: column; gap: 10px; }
        .subcat-card { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 14px; border: 1px solid rgba(255, 255, 240, 0.1); cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .subcat-card:active { background: rgba(255,255,255,0.1); border-color: var(--blood); }
        .subcat-title { font-size: 15px; font-weight: 700; color: var(--ivory); text-transform: uppercase; }

        .post-card { background: rgba(255, 255, 255, 0.03); padding: 18px; border-radius: 12px; border: 1px solid rgba(255, 255, 240, 0.05); cursor: pointer; transition: 0.1s; }
        .post-card:active { background: rgba(255,255,255,0.08); border-color: var(--blood); transform: scale(0.98); }
        .post-card.is-read { opacity: 0.5; }
        .post-title { font-size: 15px; line-height: 1.4; font-weight: 600; }
        .read-marker { font-size: 10px; color: var(--ivory); border: 1px solid var(--ivory); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 8px; text-transform: uppercase; opacity: 0.7; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 500; opacity: 0; visibility: hidden; transition: 0.2s; backdrop-filter: blur(5px); }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .bottom-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--sheet-bg); border-top-left-radius: 25px; border-top-right-radius: 25px; padding: 30px 20px 45px 20px; z-index: 600; transform: translate3d(0, 100%, 0); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 -10px 50px rgba(0,0,0,0.9); max-height: 85vh; overflow-y: auto; border-top: 1px solid rgba(255,255,255,0.1); }
        .bottom-sheet.active { transform: translate3d(0, 0, 0); }
        .sheet-cat-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .sheet-cat-text { color: var(--blood); font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .sheet-title { font-size: 24px; font-weight: 900; line-height: 1.2; margin-bottom: 30px; color: var(--sheet-text); }
        .btn-sheet-read { width: 100%; background: var(--ivory); color: #000; font-weight: 900; font-size: 16px; text-transform: uppercase; padding: 18px; border-radius: 14px; border: none; cursor: pointer; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 0 20px rgba(255, 255, 240, 0.1); }
        .btn-sheet-read:active { transform: scale(0.98); opacity: 0.9; }
        .action-row { display: flex; gap: 10px; margin-bottom: 30px; }
        .btn-icon { flex: 1; height: 52px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 14px; font-weight: 700; display: flex; align-items: center; justify-content: center; font-size: 22px; transition: 0.2s; cursor: pointer; }
        .btn-icon:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        .svg-icon { width: 24px; height: 24px; fill: var(--ivory); transition: fill 0.3s ease; }
        .btn-icon.active { border-color: var(--blood); background: rgba(255, 51, 51, 0.1); }
        .btn-icon.active .svg-icon { fill: var(--blood); }
        .sheet-item { padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 14px; font-weight: 600; color: #ddd; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .sheet-arrow-icon { color: var(--blood); font-size: 18px; font-weight: bold; }
        .fab-dice { position: fixed; bottom: 30px; right: 20px; width: 56px; height: 56px; background: var(--ivory); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 90; box-shadow: 0 5px 20px rgba(0,0,0,0.5); color: #000; border: 2px solid rgba(255,255,255,0.2); }
        .fab-dice:active { transform: rotate(45deg) scale(0.9); }

        /* === –í–ê–ñ–ù–û: –ú–û–î–ê–õ–ö–ê –ò –ö–ê–†–¢–û–ß–ö–ê === */
        .celebration-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 2000; 
            display: flex; align-items: center; justify-content: center; 
            opacity: 0; visibility: hidden; transition: 0.3s; 
        }
        .celebration-modal.active { opacity: 1; visibility: visible; }
        
        .celebration-card { 
            position: relative; 
            background: #111; border: 2px solid var(--ivory); border-radius: 24px; padding: 30px; 
            width: 85%; max-width: 350px; text-align: center; 
            box-shadow: 0 0 50px rgba(255,255,240,0.1); 
            transform: scale(0.8); transition: transform 0.3s; 
            overflow: hidden; 
            z-index: 10;
        }
        .celebration-modal.active .celebration-card { transform: scale(1); }
        
        #celCloseBtn { width: 100%; background: var(--ivory); color: #000; font-weight: 800; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; position: relative; z-index: 20; }
        #celIcon, #celName, #celMsg { position: relative; z-index: 10; }

        /* ======================================================== */
        /* ============  PREMIUM STYLES FOR ACHIEVEMENTS ============ */
        /* ======================================================== */

        /* --- 1. SUPERHUMAN (C–û–•–†–ê–ù–ï–ù–û) --- */
        .celebration-card.superhuman-card { 
            border: 2px solid #ff3333; 
            background: radial-gradient(circle at center, #4a0000 0%, #1a0505 60%, #000000 100%);
            box-shadow: 0 0 60px rgba(255, 0, 0, 0.5), inset 0 0 40px rgba(255, 0, 0, 0.2); 
        }
        .blood-rune-ring { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 50%; pointer-events: none; z-index: 1; }
        .ring-char { position: absolute; top: 0; left: 50%; font-family: 'Courier New', monospace; font-weight: bold; color: #ff3333; text-shadow: 0 0 5px #ff0000; }
        @keyframes rotateLoop { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        .main-rune-box { font-size: 90px; margin-bottom: 5px; position: relative; z-index: 10; color: #ff3333; text-shadow: 0 0 40px rgba(255, 0, 0, 0.8), 0 0 10px red; animation: pulseRune 4s ease-in-out infinite; }
        .super-title { color: #ff5555 !important; text-shadow: 0 0 20px rgba(255, 0, 0, 0.6) !important; font-family: 'Times New Roman', serif; letter-spacing: 2px; font-size: 24px !important; position: relative; z-index: 10; }
        .super-btn { background: linear-gradient(180deg, #cc0000 0%, #660000 100%) !important; color: #ffcccc !important; border: 1px solid #ff3333 !important; box-shadow: 0 5px 25px rgba(200,0,0,0.4); }
        @keyframes pulseRune { 0%, 100% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 10px red); } 50% { transform: scale(1.05); opacity: 0.9; filter: drop-shadow(0 0 25px red); } }

        /* --- 2. ADSKOE PEKLO (HELL) --- */
        .celebration-card.inferno-card {
            border: 2px solid #ff4500;
            background: #000;
            box-shadow: 0 0 60px rgba(255, 69, 0, 0.4);
            overflow: hidden;
        }
        .fire-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            filter: blur(12px) contrast(20); 
            background: #000; z-index: 0;
            opacity: 0.4;
        }
        .lava-dark-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.7); z-index: 1; pointer-events: none;
        }
        .fire-blob {
            position: absolute; bottom: -30px;
            border-radius: 50%; opacity: 0.8;
            animation: magmaRise 8s infinite ease-in-out;
            background: radial-gradient(circle, #ffaa00, #ff4500, #b30000);
        }
        @keyframes magmaRise {
            0% { transform: translateY(0) scale(1) translateX(0); }
            33% { transform: translateY(-120px) scale(1.3) translateX(30px); }
            66% { transform: translateY(-240px) scale(0.8) translateX(-30px); }
            100% { transform: translateY(-380px) scale(1.2) translateX(10px); }
        }
        .celebration-card.inferno-card #celName { color: #ff8800 !important; font-weight: 900; letter-spacing: 1px; text-shadow: 0 0 15px #ff0000; position: relative; z-index: 10; }
        .celebration-card.inferno-card #celMsg { position: relative; z-index: 10; color: #ffd6cc !important; }
        .celebration-card.inferno-card #celCloseBtn { 
            background: linear-gradient(45deg, #ff4500, #b30000) !important; color: #fff !important; 
            box-shadow: 0 0 20px rgba(255, 69, 0, 0.5) !important;
            position: relative; z-index: 20;
        }

        /* --- 3. TEMPTER (ROSES) --- */
        .celebration-card.tempter-card {
            border: 2px solid #d60270;
            background: radial-gradient(circle, #2a001a 0%, #000 100%);
            box-shadow: 0 0 50px rgba(214, 2, 112, 0.3);
        }
        .rose-item {
            position: absolute; top: -50px; font-size: 24px; z-index: 1; opacity: 0;
            animation: gentleFall 8s linear infinite;
        }
        @keyframes gentleFall {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            50% { transform: translateX(30px) rotate(180deg); }
            100% { top: 110%; transform: translateX(-30px) rotate(360deg); opacity: 0; }
        }
        .celebration-card.tempter-card #celName { color: #d60270 !important; font-family: serif; font-style: italic; font-size: 24px !important; text-shadow: 0 0 10px #d60270; }
        .celebration-card.tempter-card #celCloseBtn { 
            background: #d60270 !important; color: #fff !important; 
            border: 1px solid #ff69b4 !important;
        }

        /* --- 4. UNWAVERING (–ù–ï–ü–û–ö–û–õ–ï–ë–ò–ú–´–ô) --- */
        .celebration-card.shield-card {
            border: 2px solid #f1c40f;
            background: linear-gradient(135deg, #2c2c2c 0%, #000 100%);
            box-shadow: 0 0 40px rgba(241, 196, 15, 0.2);
        }
        .shield-bg-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 220px; color: rgba(241, 196, 15, 0.05); z-index: 0;
            animation: shieldRock 4s ease-in-out infinite;
        }
        @keyframes shieldRock { 0%, 100% { transform: translate(-50%, -50%) rotate(-5deg); } 50% { transform: translate(-50%, -50%) rotate(5deg); } }
        .celebration-card.shield-card #celName { color: #f1c40f !important; text-transform: uppercase; font-weight: 800; letter-spacing: 3px; }
        .celebration-card.shield-card #celCloseBtn { 
            background: #f1c40f !important; color: #000 !important; 
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.4) !important;
        }

        /* --- 5. ATTENTIVE (–í–ù–ò–ú–ê–¢–ï–õ–¨–ù–´–ô) --- */
        .celebration-card.attentive-card {
            border: 1px solid #00ffaa;
            background: #000;
            box-shadow: 0 0 30px rgba(0, 255, 170, 0.2);
            overflow: hidden;
        }
        .rune-bg-static {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-family: monospace; font-size: 14px; line-height: 14px;
            color: #004433; word-break: break-all; opacity: 0.2; z-index: 0;
            padding: 10px; overflow: hidden;
        }
        .scanner-beam {
            position: absolute; top: -20%; left: 0; width: 100%; height: 40px;
            background: linear-gradient(to bottom, transparent, rgba(0, 255, 170, 0.5), transparent);
            z-index: 1; mix-blend-mode: hard-light; 
            animation: beamScan 3s linear infinite;
        }
        @keyframes beamScan { 0% { top: -20%; } 100% { top: 120%; } }
        .celebration-card.attentive-card #celName { color: #00ffaa !important; font-family: monospace; letter-spacing: 2px; position: relative; z-index: 2; text-shadow: 0 0 5px #000; }
        .celebration-card.attentive-card #celCloseBtn { background: #000 !important; border: 1px solid #00ffaa !important; color: #00ffaa !important; position: relative; z-index: 2; }

        /* --- 6. ADULT (–í–ó–†–û–°–õ–´–ô) --- */
        .celebration-card.adult-card {
            border: 2px solid #3498db;
            background: linear-gradient(180deg, #000 0%, #0a1a2a 100%);
            box-shadow: 0 0 50px rgba(52, 152, 219, 0.3);
            perspective: 600px;
        }
        .cube-shape {
            position: absolute; 
            border: 2px solid rgba(52, 152, 219, 0.3);
            background: rgba(52, 152, 219, 0.1);
            animation: squareFloat 8s infinite linear;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.05);
            border-radius: 4px;
        }
        @keyframes squareFloat {
            0% { transform: translateY(100px) rotate(0deg) scale(0.8); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(-300px) rotate(90deg) scale(1.2); opacity: 0; }
        }
        .celebration-card.adult-card #celName { color: #3498db !important; letter-spacing: 2px; font-weight: 600; position: relative; z-index: 10; text-shadow: 0 0 10px #000; }
        .celebration-card.adult-card #celCloseBtn { background: #3498db !important; color: #fff !important; position: relative; z-index: 10; }

        /* --- 7. I'M FREE (–Ø –°–í–û–ë–û–î–ï–ù) --- */
        .celebration-card.free-card {
            border: 2px solid #87CEEB;
            background: linear-gradient(to bottom, #001133 0%, #1e3c72 100%); 
            box-shadow: 0 0 50px rgba(135, 206, 235, 0.3);
        }
        .sky-feather {
            position: absolute; top: -50px; font-size: 24px; color: rgba(255,255,255,0.7);
            z-index: 1; 
            animation: featherSway 8s ease-in-out infinite;
        }
        @keyframes featherSway {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 0; }
            20% { opacity: 0.8; }
            25% { transform: translateX(20px) rotate(15deg); }
            50% { transform: translateX(-20px) rotate(-15deg); }
            75% { transform: translateX(20px) rotate(10deg); }
            100% { top: 110%; transform: translateX(0) rotate(-5deg); opacity: 0; }
        }
        .celebration-card.free-card #celName { color: #fff !important; text-shadow: 0 0 10px #87CEEB; position: relative; z-index: 10; }
        .celebration-card.free-card #celCloseBtn { background: #fff !important; color: #1e3c72 !important; font-weight: 900; position: relative; z-index: 10; }

        /* --- 8. AESTHETE (–≠–°–¢–ï–¢) --- */
        .celebration-card.esthete-card {
            border: 2px solid #9b59b6;
            background: #0a000a;
            box-shadow: 0 0 40px rgba(155, 89, 182, 0.3);
        }
        .flash-star {
            position: absolute; color: #e8daef; font-size: 14px;
            animation: softTwinkle 3s infinite ease-in-out;
            opacity: 0.4;
        }
        @keyframes softTwinkle { 
            0%, 100% { opacity: 0.2; transform: scale(0.8); } 
            50% { opacity: 0.8; transform: scale(1.2); text-shadow: 0 0 5px #fff; } 
        }
        .celebration-card.esthete-card #celName { color: #e8daef !important; font-family: 'Didot', serif; letter-spacing: 3px; font-weight: bold; position: relative; z-index: 10; }
        .celebration-card.esthete-card #celCloseBtn { background: #9b59b6 !important; color: #fff !important; font-family: 'Didot', serif; position: relative; z-index: 10; }

        /* --- 9. MANIPULATOR (–ú–ê–ù–ò–ü–£–õ–Ø–¢–û–†) - CORNER MASKS --- */
        .celebration-card.manip-card {
            border: 2px solid #ff3333;
            background: #110505;
            /* box-shadow: inset 0 0 60px #300; */
            overflow: hidden;
        }
        .corner-mask {
            position: absolute;
            font-size: 80px;
            z-index: 1;
            opacity: 0.5;
            filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.6));
        }
        .mask-top-left {
            top: -10px;
            left: -10px;
            animation: pulseTL 3s infinite ease-in-out alternate;
        }
        .mask-bottom-right {
            bottom: -10px;
            right: -10px;
            animation: pulseBR 3s infinite ease-in-out alternate;
        }

        @keyframes pulseTL {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.2) translate(13px, 13px); } /* –î–≤–∏–≥–∞–µ—Ç—Å—è –≤–Ω–∏–∑-–≤–ø—Ä–∞–≤–æ */
        }
        @keyframes pulseBR {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.2) translate(-13px, -13px); } /* –î–≤–∏–≥–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö-–≤–ª–µ–≤–æ */
        }

        .celebration-card.manip-card #celName { color: #ff3333 !important; text-transform: uppercase; border-bottom: 2px solid #ff3333; padding-bottom: 5px; position: relative; z-index: 10; }
        .celebration-card.manip-card #celCloseBtn { background: #300 !important; color: #ff3333 !important; border: 1px solid #ff3333 !important; position: relative; z-index: 10; }

        /* --- 10. PSYCHONAUT (–ü–°–ò–•–û–ù–ê–í–¢) --- */
        .celebration-card.psycho-card {
            border: 2px solid #555;
            background: #000;
            overflow: hidden;
            perspective: 200px; 
        }
        .tunnel-star {
            position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%;
            top: 50%; left: 50%;
            animation: warpSpeed 3s linear infinite; opacity: 0;
        }
        @keyframes warpSpeed {
            0% { transform: translate3d(var(--tx), var(--ty), -500px); opacity: 0; }
            20% { opacity: 0.5; }
            100% { transform: translate3d(calc(var(--tx) * 5), calc(var(--ty) * 5), 200px); opacity: 1; width: 6px; height: 6px; }
        }
        .celebration-card.psycho-card #celName { color: #00f3ff !important; text-shadow: 0 0 10px #00f3ff; position: relative; z-index: 10; }
        .celebration-card.psycho-card #celCloseBtn { background: #00f3ff !important; color: #000 !important; font-weight: bold; position: relative; z-index: 10; }

        /* --- 11. MACHINE (–ú–ê–®–ò–ù–ê) --- */
        .celebration-card.machine-card {
            border: 2px solid #2ecc71;
            background: #000;
            overflow: hidden;
        }
        .celebration-card.machine-card .fire-container {
             filter: blur(10px) contrast(15);
             background: #000;
             opacity: 0.5;
        }
        .celebration-card.machine-card .fire-blob {
             background: radial-gradient(circle, #2ecc71, #006400);
             animation: slimeRise 7s infinite ease-in-out;
        }
        @keyframes slimeRise {
            0% { transform: translateY(0) scale(1) translateX(0); }
            50% { transform: translateY(-200px) scale(1.1) translateX(20px); }
            100% { transform: translateY(-400px) scale(0.9) translateX(-10px); }
        }
        .celebration-card.machine-card #celName { color: #2ecc71 !important; text-shadow: 0 0 10px #2ecc71; position: relative; z-index: 10; }
        .celebration-card.machine-card #celCloseBtn { background: #2ecc71 !important; color: #000 !important; position: relative; z-index: 10; }
        .celebration-card.machine-card #celMsg { position: relative; z-index: 10; color: #d0f0d0 !important; }

        /* --- 12. PUPPETEER (–ö–£–ö–õ–û–í–û–î) - BG BEAR --- */
        .celebration-card.puppet-card {
            border: 2px solid #f39c12;
            background: #100500;
            /* box-shadow: inset 0 0 50px #331100; */
            overflow: hidden;
        }
        .bg-bear {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px; /* –ë–æ–ª—å—à–æ–π –º–µ–¥–≤–µ–¥—å –Ω–∞ —Ñ–æ–Ω–µ */
            filter: brightness(0.4) sepia(0.5); /* –¢–µ–º–Ω—ã–π –∏ –º—Ä–∞—á–Ω—ã–π */
            opacity: 0.5; /* –ï–ª–µ –∑–∞–º–µ—Ç–Ω—ã–π */
            z-index: 0; /* –ü–æ–∑–∞–¥–∏ —Ç–µ–∫—Å—Ç–∞ */
            animation: bearFloat 6s infinite ease-in-out alternate;
        }
        @keyframes bearFloat {
            0% { transform: translate(-50%, -50%) rotate(-5deg) scale(1); }
            100% { transform: translate(-50%, -55%) rotate(5deg) scale(1.05); }
        }

        .celebration-card.puppet-card #celName { color: #f39c12 !important; position: relative; z-index: 10; }
        .celebration-card.puppet-card #celCloseBtn { background: #f39c12 !important; color: #000 !important; position: relative; z-index: 10; }

        /* --- 13. CRITIC (–ö–†–ò–¢–ò–ö) - –°–¢–ò–õ–¨–ù–´–ï –ì–õ–ê–ó–ê --- */
.celebration-card.critic-card {
    border: 2px solid #5dadec; /* –ë–æ–ª–µ–µ –±–ª–∞–≥–æ—Ä–æ–¥–Ω—ã–π –≥–æ–ª—É–±–æ–π */
    background: radial-gradient(circle at bottom, #0a1520 0%, #000 100%);
    box-shadow: 0 0 50px rgba(93, 173, 236, 0.2);
    overflow: hidden;
}

.critic-eyes-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    z-index: 0; /* –°—Ç—Ä–æ–≥–æ –Ω–∞ —Ñ–æ–Ω–µ */
    pointer-events: none;
}

.critic-eye {
    position: absolute;
    font-size: 32px; /* –ê–∫–∫—É—Ä–∞—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
    color: #8ab6d6;
    opacity: 0; /* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã */
    filter: blur(1px) drop-shadow(0 0 8px rgba(138, 182, 214, 0.4)); /* –õ–µ–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ, –±–µ–∑ –∂–µ—Å—Ç–∫–∏—Ö –∫—Ä–∞–µ–≤ */
    animation: eyeBreath 6s infinite ease-in-out;
}

/* –ì–ª–∞–∑–∞ –ø–ª–∞–≤–Ω–æ –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç, —Å–æ–∑–¥–∞–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏—è */
@keyframes eyeBreath {
    0% { transform: scale(0.8); opacity: 0.1; }
    50% { transform: scale(1.1); opacity: 0.6; }
    100% { transform: scale(0.8); opacity: 0.1; }
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –æ–Ω —á–∏—Ç–∞–ª—Å—è –ø–æ–≤–µ—Ä—Ö –≥–ª–∞–∑ */
.celebration-card.critic-card #celName { color: #5dadec !important; position: relative; z-index: 10; letter-spacing: 2px; }
.celebration-card.critic-card #celCloseBtn { background: #162b40 !important; border: 1px solid #5dadec !important; color: #5dadec !important; position: relative; z-index: 10; }
    </style>
</head>
<body>

    <div class="bg-layer"></div>
    <div class="bg-noise"></div>

    <div id="preloader">
        <div class="loader-center">
            <div class="loader-title">INQUISITION</div>
            <div class="loader-logs" id="loaderLogs">INITIALIZING...</div>
        </div>
        <div id="runeContainer"></div>
    </div>

    <div class="header-container" id="listHeader">
        <div class="header-top-row">
            <div class="back-btn" id="backToHomeBtn">‚Üê</div>
            <input type="text" id="searchInput" class="search-box" placeholder="–ü–æ–∏—Å–∫...">
        </div>
        <div class="tags-wrapper" id="tagsContainer"></div>
    </div>

    <div class="main-content" id="mainContent">
        <div id="homeWrapper">
            <div class="progress-card anim-entry" style="animation-delay: 2.0s;">
                <div class="rank-header">
                    <div>
                        <div class="rank-title">–¢–≤–æ–π —Ä–∞–Ω–≥</div>
                        <div class="rank-name" id="rankName">–ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨</div>
                    </div>
                    <div style="font-size:12px; font-weight:600; opacity:0.6;" id="progressStats">0%</div>
                </div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressBar"></div></div>
                <div class="achievements-row" id="achievementsRow"></div>
            </div>

            <div class="special-card card-gold anim-entry" id="credoBtn" style="animation-delay: 2.1s;">
                <div class="sp-title">üèõ –§–£–ù–î–ê–ú–ï–ù–¢ (–û–¢–ß–ï–¢–´)</div>
                <div class="sp-desc">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π. –ù–∞—á–Ω–∏ –æ—Ç—Å—é–¥–∞.</div>
                <div class="sp-bg-icon">üìú</div>
            </div>

            <div class="special-card anim-entry" id="favBtn" style="display:none; animation-delay: 2.15s;">
                <div class="sp-title">
                    <svg viewBox="0 0 24 24" style="width:20px; height:20px;"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>
                    –ò–ó–ë–†–ê–ù–ù–û–ï
                </div>
                <div class="sp-desc">–¢–≤–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è. <span id="favCountMain">0</span> –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.</div>
                <div class="sp-bg-icon">üîñ</div>
            </div>

            <div id="homeTilesContainer"></div>
        </div>

        <div id="listViewContainer" class="hidden-screen">
             <div class="posts-list" id="postsContainer"></div>
        </div>
    </div>

    <div class="fab-dice" id="randomBtn">üé≤</div>

    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="bottom-sheet" id="postSheet">
        <div style="width: 40px; height: 4px; background: #333; border-radius: 10px; margin: 0 auto 20px auto;"></div>
        <div class="sheet-cat-wrapper" id="sheetCatWrapper">
            <span class="sheet-cat-icon" id="sheetIcon">üíÄ</span>
            <span class="sheet-cat-text" id="sheetCategory">...</span>
        </div>
        <div class="sheet-title" id="sheetTitle">...</div>
        <button class="btn-sheet-read" id="readBtn"><span>–ß–ò–¢–ê–¢–¨</span><span style="font-size:18px;">‚Üó</span></button>
        <div class="action-row">
            <button class="btn-icon" id="favSheetBtn"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg></button>
            <button class="btn-icon" id="shareBtn"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
        </div>
        <div class="sheet-header-small">–ï–©–Å –ü–û –¢–ï–ú–ï</div>
        <div id="relatedContainer" class="sheet-list"></div>
    </div>

    <div id="celebrationModal" class="celebration-modal">
        <div class="celebration-card" id="celCard">
            <div style="font-size:50px; margin-bottom:15px;" id="celIcon">üèÜ</div>
            <div style="color:var(--ivory); font-weight:900; font-size:20px; margin-bottom:10px; text-transform:uppercase;" id="celName">...</div>
            <div style="color:#888; margin-bottom:20px; font-size:14px; line-height:1.4;" id="celMsg">...</div>
            <button id="celCloseBtn">–û–¢–õ–ò–ß–ù–û</button>
        </div>
    </div>

    <script>
        // === LOGS ===
        const logs = [ "SYSTEM CHECK...", "NEURAL HANDSHAKE...", "ACCESSING ARCHIVES...", "PURGING HERETICS...", "BIO-METRICS: OK", "LOADING PROTOCOL 666...", "REALITY SYNC...", "DECRYPTING TRUTH...", "WAKE UP NEO...", "ESTABLISHING LINK..." ];
        const logElement = document.getElementById('loaderLogs');
        setInterval(() => { logElement.innerText = logs[Math.floor(Math.random() * logs.length)]; }, 120);

        // === RUNE STORM ===
        const runes = ['·öõ', '·öú', '·ö†', '·ö¢', '·ö¶', '·ö®', '·ö±', '·ö≤', '·ö≥', '·õâ', '·õ¶', '·õØ', '‚ò†', '‚ò´', '‚ò¨', '‚òæ', '‚öî', '‚ö°'];
        const container = document.getElementById('runeContainer');
        let interval;

        function spawnRune() {
            const el = document.createElement('div');
            el.className = 'rune-particle';
            el.innerText = runes[Math.floor(Math.random() * runes.length)];
            el.style.left = Math.random() * 100 + 'vw';
            el.style.top = Math.random() * 100 + 'vh';
            
            const isBoss = Math.random() > 0.9;
            const size = isBoss ? (Math.random() * 100 + 50) : (Math.random() * 30 + 10);
            el.style.fontSize = size + 'px';
            if (isBoss) el.style.color = '#ff3333'; 
            
            const driftX = (Math.random() - 0.5) * 600 + 'px';
            const driftY = (Math.random() - 0.5) * 600 + 'px';
            const rx = Math.random(); const ry = Math.random(); const rz = Math.random();
            el.style.setProperty('--driftX', driftX); el.style.setProperty('--driftY', driftY);
            el.style.setProperty('--rx', rx); el.style.setProperty('--ry', ry); el.style.setProperty('--rz', rz);
            
            const speed = Math.random() * 1.5 + 0.5;
            el.style.animation = `chaosZoom ${speed}s cubic-bezier(0.1, 0.8, 0.2, 1) forwards`;
            
            container.appendChild(el);
            setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, speed * 1000 + 100);
        }
        interval = setInterval(spawnRune, 20);

        // === DATA & LOGIC ===
        let postsDB = [];
        let favCache = new Set(); 
        let appInitialized = false;

        const tg = window.Telegram.WebApp;
        try { tg.expand(); tg.setHeaderColor('#1a0508'); tg.setBackgroundColor('#1a0508'); } catch(e){}

        const KEY_READ = 'inq_read_vFinal2';
        const KEY_FAV = 'inq_fav_vFinal2';
        const KEY_NOTIFIED = 'inq_notified_vFinal2';

        const ACHIEVEMENTS_CONFIG = {
            "üíÄ": { name: "–ê–î–°–ö–û–ï –ü–ï–ö–õ–û", icon: "üíÄ", color: "#ff4500", msg: "–¢–µ–±–µ –∑–Ω–∞–∫–æ–º –ø—Ä–∏–≤–∫—É—Å –∞–¥—Å–∫–æ–≥–æ –ø–µ–∫–ª–∞." },
            "üëÅ": { name: "–ö–†–ò–¢–ò–ö", icon: "üëÅ", color: "#3498db", msg: "–¢—ã –≤–∏–¥–∏—à—å —Å–∫–≤–æ–∑—å –ª–æ–∂—å." },
            "‚ù§Ô∏è": { name: "–ò–°–ö–£–°–ò–¢–ï–õ–¨", icon: "‚ù§Ô∏è", color: "#d60270", msg: "–ñ–µ–Ω—Å–∫–∏–π –º–æ–∑–≥ –¥–ª—è —Ç–µ–±—è –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≥–∞–¥–∫–∞." },
            "‚öîÔ∏è": { name: "–ö–£–ö–õ–û–í–û–î", icon: "‚öîÔ∏è", color: "#f39c12", msg: "–¢–µ–º–Ω—ã–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞ —Ç–µ–ø–µ—Ä—å —Å–ª—É–∂–∞—Ç —Ç–µ–±–µ." },
            "üõ°": { name: "–ù–ï–ü–û–ö–û–õ–ï–ë–ò–ú–´–ô", icon: "üõ°", color: "#f1c40f", msg: "–¢–≤–æ–π —Ä–∞–∑—É–º –∑–∞—â–∏—â–µ–Ω." },
            "üß™": { name: "–ú–ê–®–ò–ù–ê", icon: "üß™", color: "#2ecc71", msg: "–¢–µ–ª–æ –≤—ã–≤–µ–¥–µ–Ω–æ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å." },
            "üèõ": { name: "–í–ù–ò–ú–ê–¢–ï–õ–¨–ù–´–ô", icon: "üèõ", color: "#FFFFF0", msg: "–¢—ã –∏–∑—É—á–∏–ª –≤—Å–µ –æ—Ç—á–µ—Ç—ã –ò–Ω–∫–≤–∏–∑–∏—Ü–∏–∏." },
            "üíä": { name: "–í–ó–†–û–°–õ–´–ô", icon: "üíä", color: "#3498db", msg: "–ò–Ω—Ñ–∞–Ω—Ç–∏–ª—å–Ω–æ—Å—Ç—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞." },
            "üö≠": { name: "–Ø –°–í–û–ë–û–î–ï–ù", icon: "üö≠", color: "#f1c40f", msg: "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–≤–µ—Ä–∂–µ–Ω—ã." },
            "üëî": { name: "–≠–°–¢–ï–¢", icon: "üëî", color: "#9b59b6", msg: "–°—Ç–∏–ª—å ‚Äî —Ç–≤–æ–µ –æ—Ä—É–∂–∏–µ." },
            "üé≠": { name: "–ú–ê–ù–ò–ü–£–õ–Ø–¢–û–†", icon: "üé≠", color: "#ff3333", msg: "–í—Ä—É—á–∏—Ç—å —Ç–µ–±–µ –∫–Ω–∏–≥—É –ø–æ –∫—Ä–∞—Å–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏?)" },
            "‚ö°Ô∏è": { name: "–ü–°–ò–•–û–ù–ê–í–¢", icon: "‚ö°Ô∏è", color: "#00f3ff", msg: "–ü—Å–∏—Ö–∏–∫–∞ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º." }
        };

        const UI = {
            home: document.getElementById('homeWrapper'),
            list: document.getElementById('listViewContainer'),
            tiles: document.getElementById('homeTilesContainer'),
            posts: document.getElementById('postsContainer'),
            back: document.getElementById('backToHomeBtn'),
            search: document.getElementById('searchInput'),
            tags: document.getElementById('tagsContainer'),
            sheet: document.getElementById('postSheet'),
            overlay: document.getElementById('modalOverlay'),
            favBtn: document.getElementById('favBtn')
        };

        let currentCat = null;
        let currentSubCat = null;
        let searchQ = "";
        let celebrationQueue = [];

        function safeVib(type='light') { try { tg.HapticFeedback.impactOccurred(type); } catch(e){} }
        function getRead() { try { return JSON.parse(localStorage.getItem(KEY_READ) || '[]'); } catch(e){ return []; } }
        function getNotified() { try { return JSON.parse(localStorage.getItem(KEY_NOTIFIED) || '[]'); } catch(e){ return []; } }
        
        function loadFavs() {
            try {
                const arr = JSON.parse(localStorage.getItem(KEY_FAV) || '[]');
                favCache = new Set(arr);
            } catch(e) { favCache = new Set(); }
        }

        function toggleFav(u) {
            if(favCache.has(u)) favCache.delete(u); else favCache.add(u);
            localStorage.setItem(KEY_FAV, JSON.stringify(Array.from(favCache)));
            updateFavUI();
            return favCache.has(u);
        }

        function updateFavUI() {
            if(favCache.size > 0) { 
                UI.favBtn.style.display = 'flex'; 
                if (appInitialized) {
                    UI.favBtn.classList.remove('anim-entry');
                    UI.favBtn.classList.add('visible-static');
                    UI.favBtn.style.animationDelay = '0s';
                }
                document.getElementById('favCountMain').innerText = favCache.size; 
            } else { 
                UI.favBtn.style.display = 'none'; 
            }
        }

        function saveRead(u) {
            let l = getRead();
            if(!l.includes(u)) { l.push(u); localStorage.setItem(KEY_READ, JSON.stringify(l)); updateProgress(true); return true; }
            return false;
        }

        function updateProgress(silent = false) {
            if(postsDB.length === 0) return;
            const r = getRead(); const notified = getNotified();
            const tot = postsDB.length; const done = postsDB.filter(x=>r.includes(x.u)).length;
            const per = tot ? Math.round((done/tot)*100) : 0;

            document.getElementById('progressBar').style.width = per + '%';
            document.getElementById('progressStats').innerText = `${done}/${tot} (${per}%)`;

            let rank = "–ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨";
            if(per>=10) rank = "–°–¢–†–ê–ñ"; if(per>=30) rank = "–ö–û–ù–°–£–õ"; if(per>=50) rank = "–ü–û–°–û–õ"; if(per>=75) rank = "–û–†–ê–ö–£–õ"; if(per>=100) rank = "–ë–û–ì";
            const rn = document.getElementById('rankName'); rn.innerText = rank;
            if(rank==="–ë–û–ì") rn.classList.add('gold'); else rn.classList.remove('gold');

            const box = document.getElementById('achievementsRow'); box.innerHTML = '';
            Object.keys(ACHIEVEMENTS_CONFIG).forEach(icon => {
                const catName = postsDB.find(p => p.c.includes(icon))?.c;
                if(!catName) return; 
                const items = postsDB.filter(x=>x.c===catName);
                const isFull = items.length > 0 && items.every(x=>r.includes(x.u));
                const conf = ACHIEVEMENTS_CONFIG[icon];
                
                const b = document.createElement('div');
                b.className = `badge ${isFull?'unlocked':''}`; b.innerText = icon;
                if(isFull) {
                    b.style.borderColor = conf.color; b.style.boxShadow = `0 0 10px ${conf.color}44`;
                    b.onclick = () => showCel(icon, conf.name, conf.msg, conf.color);
                    if (!notified.includes(catName)) {
                        if (!celebrationQueue.find(item => item.id === catName)) celebrationQueue.push({ id: catName, icon: icon, title: conf.name, msg: conf.msg, color: conf.color });
                    }
                } else { b.onclick = () => showLockedModal(icon, catName); }
                box.appendChild(b);
            });

            const allCatsUnlocked = Object.keys(ACHIEVEMENTS_CONFIG).every(icon => {
                const catName = postsDB.find(p => p.c.includes(icon))?.c;
                if(!catName) return true;
                const items = postsDB.filter(x=>x.c===catName);
                return items.every(x=>r.includes(x.u));
            });
            const isSuper = (per === 100 && allCatsUnlocked);
            const superBadge = document.createElement('div');
            if (isSuper) {
                superBadge.className = 'badge unlocked';
                superBadge.innerHTML = `<svg viewBox="0 0 24 24" style="width:20px;height:20px;fill:#FFD700;"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>`;
                superBadge.style.borderColor = "#FFD700"; superBadge.style.boxShadow = "0 0 15px rgba(255, 215, 0, 0.4)";
                superBadge.onclick = () => showCel("‚ö°Ô∏è", "–°–í–ï–†–•–ß–ï–õ–û–í–ï–ö", "–¢—ã –¥–æ—Å—Ç–∏–≥ –∞–±—Å–æ–ª—é—Ç–∞.", "#FFD700", true);
                const superId = "SUPERHUMAN";
                if (!notified.includes(superId) && !celebrationQueue.find(item => item.id === superId)) celebrationQueue.push({ id: superId, icon: "‚ö°Ô∏è", title: "–°–í–ï–†–•–ß–ï–õ–û–í–ï–ö", msg: "–¢—ã –¥–æ—Å—Ç–∏–≥ –∞–±—Å–æ–ª—é—Ç–∞.", isSuper: true });
            } else {
                superBadge.className = 'badge secret-badge'; superBadge.innerText = "?";
                superBadge.onclick = () => {
                    safeVib('light'); document.getElementById('celIcon').innerText = "üëÅ";
                    document.getElementById('celName').innerText = "–¢–ê–ô–ù–û–ï –ó–ù–ê–ù–ò–ï";
                    document.getElementById('celName').style.color = "#666"; document.getElementById('celName').style.textShadow = "none";
                    document.getElementById('celMsg').innerText = "–û—Ç–∫—Ä–æ–π –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —á—Ç–æ –∑–¥–µ—Å—å —Å–∫—Ä—ã—Ç–æ.";
                    document.getElementById('celCard').style.borderColor = "#333";
                    document.getElementById('celCloseBtn').style.background = "#333";
                    document.getElementById('celebrationModal').classList.add('active');
                };
            }
            box.appendChild(superBadge); 
        }

        function showLockedModal(icon, catName) {
            safeVib('light');
            const card = document.getElementById('celCard');
            // Clean
            card.className = "celebration-card";
            card.querySelectorAll('div:not(#celIcon):not(#celName):not(#celMsg):not(#celCloseBtn)').forEach(e => e.remove());
            
            const iconEl = document.getElementById('celIcon');
            iconEl.className = ""; 
            
            card.style.background = "#111"; card.style.borderColor = "#333"; card.style.boxShadow = "none";
            iconEl.innerText = "üîí"; 
            document.getElementById('celName').innerText = "–ó–ê–ö–†–´–¢–û";
            document.getElementById('celName').style.color = "#666"; document.getElementById('celName').style.textShadow = "none";
            document.getElementById('celMsg').innerHTML = `–ò–∑—É—á–∏ –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ —Ä–∞–∑–¥–µ–ª–µ:<br><br><span style="color:#fff; font-weight:bold;">${catName}</span>`;
            document.getElementById('celCloseBtn').className = "";
            document.getElementById('celCloseBtn').style.background = "#333";
            document.getElementById('celCloseBtn').style.color = "#888"; 
            document.getElementById('celCloseBtn').style.boxShadow = "none";
            document.getElementById('celebrationModal').classList.add('active');
        }

        function showCel(icon, title, msg, color, isSuper = false) {
            safeVib('heavy');
            const card = document.getElementById('celCard');
            const btn = document.getElementById('celCloseBtn');
            const nameEl = document.getElementById('celName');
            const iconEl = document.getElementById('celIcon');
            const msgEl = document.getElementById('celMsg');
            
            // RESET
            card.className = "celebration-card";
            btn.className = "";
            card.style.cssText = ""; btn.style.cssText = ""; 
            card.querySelectorAll('div:not(#celIcon):not(#celName):not(#celMsg):not(#celCloseBtn)').forEach(e => e.remove());
            
            iconEl.className = ""; iconEl.innerHTML = icon;
            btn.innerText = "–û–¢–õ–ò–ß–ù–û";

            if (isSuper) {
                // === SUPERHUMAN ===
                card.classList.add('superhuman-card');
                iconEl.innerHTML = "·ö±"; iconEl.className = "main-rune-box";
                const ringsConfig = [ { size: 150, count: 10, speed: 20, dir: 1, opacity: 0.5, fontSize: 16 }, { size: 210, count: 16, speed: 40, dir: -1, opacity: 0.3, fontSize: 18 }, { size: 280, count: 22, speed: 60, dir: 1, opacity: 0.15, fontSize: 20 } ];
                const runeChars = "·ö†·ö¢·ö¶·ö®·ö±·ö≤·ö∑·öπ·ö∫·öæ·õÅ·õÉ·õá·õà·õâ·õã·õè·õí·õñ·õó·õö·õú·õû·õü"; 
                ringsConfig.forEach(conf => {
                    const ring = document.createElement('div'); ring.className = 'blood-rune-ring';
                    ring.style.width = conf.size + 'px'; ring.style.height = conf.size + 'px'; ring.style.opacity = conf.opacity;
                    ring.style.animation = `rotateLoop ${conf.speed}s linear infinite ${conf.dir>0?'normal':'reverse'}`;
                    for(let i=0; i < conf.count; i++) {
                        const span = document.createElement('span'); span.className = 'ring-char'; span.innerText = runeChars[i % runeChars.length]; 
                        span.style.fontSize = conf.fontSize + 'px'; span.style.transformOrigin = `0 ${conf.size/2}px`; span.style.transform = `rotate(${i * (360/conf.count)}deg)`; ring.appendChild(span);
                    }
                    card.appendChild(ring);
                });
                nameEl.innerText = title; nameEl.className = "super-title";
                msgEl.innerText = msg; msgEl.style.color = "#bb7777";
                btn.className = "super-btn"; 
            }
            else if (icon === "üíÄ") {
                // === HELL'S INFERNO ===
                card.classList.add('inferno-card');
                const cont = document.createElement('div'); cont.className = 'fire-container';
                const darkOv = document.createElement('div'); darkOv.className = 'lava-dark-overlay';
                
                const colors = ['#ff4500', '#ff8800', '#ff0000', '#d35400'];
                for(let i=0; i<30; i++) {
                    const b = document.createElement('div'); b.className = 'fire-blob';
                    b.style.left = (Math.random()*100 - 10) + '%';
                    const dur = Math.random()*4 + 4; 
                    b.style.animationDuration = dur + 's';
                    b.style.animationDelay = (Math.random()* -dur) + 's'; 
                    const size = Math.random()*50 + 20; b.style.width=size+'px'; b.style.height=size+'px';
                    b.style.background = colors[Math.floor(Math.random()*colors.length)];
                    cont.appendChild(b);
                }
                card.appendChild(cont); card.appendChild(darkOv);
                nameEl.innerText = title; msgEl.innerText = msg;
            }
            else if (icon === "‚ù§Ô∏è") {
                // === TEMPTER (ROSES) ===
                card.classList.add('tempter-card');
                const petals = ['üåπ', 'ü•Ä', 'üçÉ'];
                for(let i=0; i<12; i++) {
                    const p = document.createElement('div'); p.className = 'rose-item';
                    p.innerText = petals[Math.floor(Math.random()*petals.length)];
                    p.style.left = (Math.random()*90) + '%';
                    const dur = Math.random()*3 + 5; 
                    p.style.animationDuration = dur + 's';
                    p.style.animationDelay = (Math.random() * 5) + 's'; 
                    card.appendChild(p);
                }
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#ff69b4";
            }
            else if (icon === "üõ°") {
                // === UNWAVERING ===
                card.classList.add('shield-card');
                const s = document.createElement('div'); s.className = 'shield-bg-icon'; s.innerHTML = 'üõ°'; card.appendChild(s);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#f1c40f";
            }
            else if (icon === "üèõ") {
                // === ATTENTIVE ===
                card.classList.add('attentive-card');
                const bg = document.createElement('div'); bg.className = 'rune-bg-static';
                let txt = ""; for(let i=0; i<600; i++) txt += (Math.random()>0.5 ? "0" : "1") + " ";
                bg.innerText = txt; card.appendChild(bg);
                const beam = document.createElement('div'); beam.className = 'scanner-beam'; card.appendChild(beam);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#ccc";
            }
            else if (icon === "üíä") {
                // === ADULT ===
                card.classList.add('adult-card');
                for(let i=0; i<10; i++) {
                    const c = document.createElement('div'); c.className = 'cube-shape';
                    const s = Math.random()*60 + 20; c.style.width=s+'px'; c.style.height=s+'px';
                    c.style.left = (Math.random()*90)+'%';
                    const dur = Math.random()*6 + 6;
                    c.style.animationDuration = dur + 's';
                    c.style.animationDelay = (Math.random() * -dur) + 's';
                    card.appendChild(c);
                }
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#85c1e9";
            }
            else if (icon === "üö≠") {
                // === FREE (FEATHERS) ===
                card.classList.add('free-card');
                for(let i=0; i<15; i++) {
                    const f = document.createElement('div'); f.className = 'sky-feather'; f.innerHTML = 'ü™∂';
                    f.style.left = (Math.random()*90)+'%';
                    const dur = Math.random()*3 + 6; // 6-9 sec
                    f.style.animationDuration = dur + 's';
                    f.style.animationDelay = (Math.random() * -dur) + 's';
                    card.appendChild(f);
                }
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#ddd";
            }
            else if (icon === "üëî") {
                // === AESTHETE ===
                card.classList.add('esthete-card');
                for(let i=0; i<30; i++) {
                    const s = document.createElement('div'); s.className = 'flash-star'; s.innerHTML = '‚ú¶';
                    s.style.left = (Math.random()*100)+'%'; s.style.top = (Math.random()*100)+'%';
                    const dur = Math.random()*2 + 2; s.style.animationDuration = dur + 's';
                    s.style.animationDelay = (Math.random() * -dur) + 's';
                    card.appendChild(s);
                }
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#e8daef";
            }
            else if (icon === "üé≠") {
                // === MANIPULATOR (CORNER MASKS) ===
                card.classList.add('manip-card');
                const m1 = document.createElement('div'); m1.className = 'corner-mask mask-top-left'; m1.innerHTML = 'üëπ';
                const m2 = document.createElement('div'); m2.className = 'corner-mask mask-bottom-right'; m2.innerHTML = 'üëπ';
                card.appendChild(m1); card.appendChild(m2);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#e74c3c";
            }
            else if (icon === "‚ö°Ô∏è") {
                // === PSYCHONAUT ===
                card.classList.add('psycho-card');
                for(let i=0; i<40; i++) {
                    const s = document.createElement('div'); s.className = 'tunnel-star';
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.random() * 200 + 50;
                    s.style.setProperty('--tx', Math.cos(angle)*radius + 'px');
                    s.style.setProperty('--ty', Math.sin(angle)*radius + 'px');
                    s.style.animationDelay = (Math.random() * -3) + 's';
                    card.appendChild(s);
                }
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#00f3ff";
            }
            else if (icon === "üß™") {
                // === MACHINE ===
                card.classList.add('machine-card');
                const cont = document.createElement('div'); cont.className = 'fire-container';
                const darkOv = document.createElement('div'); darkOv.className = 'lava-dark-overlay';
                
                const gColors = ['#2ecc71', '#00ff00', '#32cd32', '#006400'];
                for(let i=0; i<25; i++) {
                    const b = document.createElement('div'); b.className = 'fire-blob';
                    b.style.left = (Math.random()*100) + '%';
                    const size = Math.random()*50 + 20; b.style.width=size+'px'; b.style.height=size+'px';
                    const dur = Math.random()*5 + 5; 
                    b.style.animationDuration = dur + 's';
                    b.style.animationDelay = (Math.random() * -dur) + 's';
                    b.style.background = gColors[Math.floor(Math.random()*gColors.length)];
                    cont.appendChild(b);
                }
                card.appendChild(cont); card.appendChild(darkOv);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#2ecc71";
            }
            else if (icon === "‚öîÔ∏è") {
                // === PUPPETEER (BG BEAR) ===
                card.classList.add('puppet-card');
                const b = document.createElement('div');
                b.className = 'bg-bear';
                b.innerHTML = 'üß∏';
                card.appendChild(b);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#f39c12";
            }
            else if (icon === "üëÅ") {
                // === CRITIC (FIXED POSITIONS - NO OVERLAP) ===
                card.classList.add('critic-card');
                const bg = document.createElement('div'); bg.className = 'critic-eyes-bg';
                
                // –ß–µ—Ç–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–∞—à–∏ (top, left)
                // –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –∏—Ö –ø–æ —É–≥–ª–∞–º –∏ —Å—Ç–æ—Ä–æ–Ω–∞–º, –æ—Å—Ç–∞–≤–ª—è—è —Ü–µ–Ω—Ç—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞
                const positions = [
                    { t: '5%', l: '5%' },   { t: '5%', l: '85%' },   // –í–µ—Ä—Ö–Ω–∏–µ —É–≥–ª—ã
                    { t: '45%', l: '5%' },  { t: '45%', l: '85%' },  // –°–µ—Ä–µ–¥–∏–Ω–∞ –±–æ–∫–∞
                    { t: '85%', l: '15%' }, { t: '85%', l: '75%' }   // –ù–∏–∑
                ];

                positions.forEach((pos, index) => {
                    const eye = document.createElement('div'); 
                    eye.className = 'critic-eye';
                    eye.innerHTML = 'üëÅ'; // –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π '‚óâ' –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–≥–æ —Å—Ç–∏–ª—è
                    
                    // –°—Ç–∞–≤–∏–º –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
                    eye.style.top = pos.t;
                    eye.style.left = pos.l;
                    
                    // –†–∞–∑–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –æ–Ω–∏ "–¥—ã—à–∞–ª–∏" –Ω–µ —Ö–æ—Ä–æ–º, –∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏
                    eye.style.animationDelay = (index * 0.8) + 's'; 
                    
                    bg.appendChild(eye);
                });

                card.appendChild(bg);
                nameEl.innerText = title; msgEl.innerText = msg; msgEl.style.color = "#a0c4e0";
            }
            else {
                // === DEFAULT ===
                const accent = color || '#FFFFF0'; 
                card.style.background = `#111`; card.style.borderColor = accent; card.style.boxShadow = `0 0 40px ${accent}11`;
                nameEl.innerText = title; nameEl.style.color = accent; nameEl.style.textShadow = "none";
                msgEl.innerText = msg; msgEl.style.color = "#888";
                btn.style.background = accent; btn.style.color = "#000";
            }
            
            document.getElementById('celebrationModal').classList.add('active');
        }

        document.getElementById('celCloseBtn').onclick = () => {
             document.getElementById('celebrationModal').classList.remove('active');
             setTimeout(playPendingAnimations, 500);
        };

        function playPendingAnimations() {
            if (celebrationQueue.length > 0) {
                const item = celebrationQueue.shift();
                if (!getNotified().includes(item.id)) {
                   let n = getNotified(); n.push(item.id); localStorage.setItem(KEY_NOTIFIED, JSON.stringify(n));
                   showCel(item.icon, item.title, item.msg, item.color, item.isSuper);
                }
            }
        }

        function renderHome() {
            UI.tiles.innerHTML = ''; const cnt = {};
            postsDB.forEach(x => { if(x.c.includes("–§–£–ù–î–ê–ú–ï–ù–¢")) return; cnt[x.c] = (cnt[x.c]||0)+1; });
            
            let delay = 2.2; 
            Object.keys(cnt).forEach(c => {
                const d = document.createElement('div'); d.className = 'category-tile anim-entry'; d.style.animationDelay = delay + 's';
                setTimeout(() => { d.classList.remove('anim-entry'); d.classList.add('visible-static'); }, (delay * 1000) + 600);
                d.innerHTML = `<div class="tile-icon">${c.substring(0,2)}</div><div><div class="tile-title">${c.substring(2)}</div><div class="tile-count">${cnt[c]} –≥–ª–∞–≤</div></div>`;
                d.onclick = () => openList(c); UI.tiles.appendChild(d); delay += 0.05; 
            });
            const pCard = document.querySelector('.progress-card');
            setTimeout(() => { pCard.classList.remove('anim-entry'); pCard.classList.add('visible-static'); }, 2600);
            const sCard = document.querySelector('.special-card');
            if(sCard) setTimeout(() => { sCard.classList.remove('anim-entry'); sCard.classList.add('visible-static'); }, 2700);
        }

        function openList(cat) {
            safeVib('medium'); currentCat = cat; currentSubCat = null;
            UI.home.classList.add('hidden-screen'); UI.list.classList.remove('hidden-screen');
            UI.back.style.display = 'flex'; UI.tags.style.display = 'flex';
            document.getElementById('randomBtn').style.display = 'none';
            if (cat === 'FAV') { renderList(true); } 
            else {
                const subCats = [...new Set(postsDB.filter(p => p.c === cat && p.sc).map(p => p.sc))];
                if (subCats.length > 0) renderSubCats(cat, subCats); else renderList(true);
            }
            window.scrollTo(0,0);
        }

        UI.back.onclick = () => {
            safeVib();
            if (currentSubCat && currentCat !== 'FAV') {
                currentSubCat = null;
                const subCats = [...new Set(postsDB.filter(p => p.c === currentCat && p.sc).map(p => p.sc))];
                if (subCats.length > 0) { renderSubCats(currentCat, subCats); window.scrollTo(0,0); return; }
            }
            currentCat = null; currentSubCat = null; searchQ = ""; UI.search.value = "";
            UI.list.classList.add('hidden-screen'); UI.home.classList.remove('hidden-screen');
            UI.back.style.display = 'none'; UI.tags.style.display = 'none';
            document.getElementById('randomBtn').style.display = 'flex';
            updateProgress(true); setTimeout(playPendingAnimations, 300);
        };

        function renderSubCats(cat, subCats) {
            UI.posts.innerHTML = ''; UI.tags.style.display = 'none';
            const head = document.createElement('div'); head.className = 'section-header'; head.innerText = cat; UI.posts.appendChild(head);
            subCats.forEach((sc, idx) => {
                const d = document.createElement('div'); d.className = 'subcat-card anim-entry'; d.style.animationDelay = (idx * 0.02) + 's';
                d.innerHTML = `<div class="subcat-title">${sc}</div><div class="subcat-arrow">‚Üí</div>`;
                d.onclick = () => { safeVib('light'); currentSubCat = sc; renderList(true); }; UI.posts.appendChild(d);
            });
        }
        
        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function renderList(animate = false) {
            UI.posts.innerHTML = ''; UI.tags.style.display = 'flex'; renderTags();
            const r = getRead(); 
            const filtered = postsDB.filter(p => {
                let mc = true; if(currentCat === 'FAV') mc = favCache.has(p.u); else if(currentCat) { mc = p.c === currentCat; if (currentSubCat) mc = mc && p.sc === currentSubCat; }
                const ms = p.t.toLowerCase().includes(searchQ.toLowerCase()); return mc && ms;
            });

            if(filtered.length === 0) { UI.posts.innerHTML = `<div style="text-align:center; opacity:0.5; margin-top:30px;">${currentCat === 'FAV' ? '–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤' : '–ü—É—Å—Ç–æ...'}</div>`; return; }

            const head = document.createElement('div'); head.className = 'section-header';
            if (currentCat === 'FAV') head.innerText = '–ò–ó–ë–†–ê–ù–ù–û–ï'; else head.innerText = currentSubCat ? `${currentCat} / ${currentSubCat}` : currentCat;
            UI.posts.appendChild(head);

            const fragment = document.createDocumentFragment(); let delay = 0;
            filtered.forEach((p, index) => {
                const isR = r.includes(p.u); const el = document.createElement('div');
                if(index < 12 && animate) { el.className = `post-card ${isR?'is-read':''} anim-entry`; el.style.animationDelay = delay + 's'; delay += 0.02; } 
                else { el.className = `post-card ${isR?'is-read':''} visible-static`; }
                
                const displayTitle = highlightText(p.t, searchQ);
                
                el.innerHTML = `<div class="post-title">${displayTitle}</div><div class="read-marker" style="display:${isR?'inline-block':'none'}">–ü–†–û–ß–ò–¢–ê–ù–û</div>`;
                el.onclick = () => openSheet(p); fragment.appendChild(el);
            });
            UI.posts.appendChild(fragment);
        }

        function renderTags() {
            UI.tags.innerHTML = '';
            const all = document.createElement('div'); all.className = 'tag active'; all.innerText = currentSubCat || "–í–°–ï"; UI.tags.appendChild(all);
        }

        function openSheet(p) {
            safeVib('light');
            document.getElementById('sheetIcon').innerText = p.c.substring(0,2);
            document.getElementById('sheetCategory').innerText = p.sc ? `${p.c.substring(2).trim()} / ${p.sc}` : p.c.substring(2).trim();
            document.getElementById('sheetTitle').innerText = p.t;
            const rBtn = document.getElementById('readBtn'); const isR = getRead().includes(p.u);
            rBtn.style.opacity = isR ? "0.7" : "1"; rBtn.innerHTML = isR ? `<span>–ü–†–û–ß–ò–¢–ê–ù–û</span><span>‚úì</span>` : `<span>–ß–ò–¢–ê–¢–¨</span><span style="font-size:18px;">‚Üó</span>`;
            rBtn.onclick = () => { safeVib(); saveRead(p.u); rBtn.style.opacity = "0.7"; rBtn.innerHTML = `<span>–ü–†–û–ß–ò–¢–ê–ù–û</span><span>‚úì</span>`; if(UI.list.style.display==='block' && currentCat !== 'FAV') renderList(false); setTimeout(() => { window.open(p.u, '_blank'); }, 50); };
            const fBtn = document.getElementById('favSheetBtn');
            const updateF = () => { const isF = favCache.has(p.u); if(isF) fBtn.classList.add('active'); else fBtn.classList.remove('active'); };
            updateF(); fBtn.onclick = () => { safeVib(); toggleFav(p.u); updateF(); };
            const sBtn = document.getElementById('shareBtn');
            sBtn.onclick = () => { safeVib(); sBtn.classList.add('active'); setTimeout(() => sBtn.classList.remove('active'), 300); window.open(`https://t.me/share/url?url=${encodeURIComponent(p.u)}&text=${encodeURIComponent(p.t)}`); };
            
            const relCon = document.getElementById('relatedContainer'); relCon.innerHTML = '';
            
            let rels = postsDB.filter(x => x.c === p.c && x.u !== p.u);
            rels = rels.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            if(rels.length === 0) relCon.innerHTML = "<div style='opacity:0.3; font-size:13px; margin-top:10px;'>–ù–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>";
            rels.forEach(r => {
                const d = document.createElement('div'); d.className = 'sheet-item'; d.innerHTML = `<span>${r.t}</span><span class="sheet-arrow-icon">‚Üí</span>`;
                d.onclick = () => { UI.overlay.click(); setTimeout(()=>openSheet(r), 200); }; relCon.appendChild(d);
            });
            UI.overlay.classList.add('active'); document.getElementById('postSheet').classList.add('active');
        }

        UI.overlay.onclick = () => { UI.overlay.classList.remove('active'); document.getElementById('postSheet').classList.remove('active'); };

        document.getElementById('credoBtn').onclick = () => openList("üèõ –§–£–ù–î–ê–ú–ï–ù–¢ (–û–¢–ß–ï–¢–´)");
        UI.favBtn.onclick = () => openList("FAV");
        document.getElementById('randomBtn').onclick = () => { safeVib('heavy'); openSheet(postsDB[Math.floor(Math.random()*postsDB.length)]); };
        UI.search.addEventListener('input', (e) => { searchQ = e.target.value; if(searchQ && UI.home.style.display!=='none') openList(null); renderList(false); });

        // === INIT ===
        async function initApp() {
            try {
                loadFavs(); 
                const response = await fetch('posts.json?t=' + new Date().getTime());
                if (!response.ok) throw new Error("JSON fail");
                postsDB = await response.json();
                
                renderHome(); 
                updateProgress();
                updateFavUI();
                
                setTimeout(() => {
                    clearInterval(interval);
                    document.getElementById('preloader').classList.add('hide');
                    appInitialized = true;
                }, 2200);
            } catch (e) { document.getElementById('preloader').innerHTML = "<div style='color:red; text-align:center;'>DATABASE ERROR<br>Check Connection</div>"; }
        }
        window.addEventListener('load', initApp);
    </script>
</body>
</html>